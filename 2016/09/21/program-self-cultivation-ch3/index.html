<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>程式設計師的自我修養〈目的檔〉 | JasonChiuCC</title>
  <meta name="author" content="JasonChiuCC">
  
  <meta name="description" content="JasonChiuCC">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="程式設計師的自我修養〈目的檔〉"/>
  <meta property="og:site_name" content="JasonChiuCC"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="JasonChiuCC" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">JasonChiuCC</a></h1>
  <h2><a href="/">You’ve got to find what you love</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首頁</a></li>
    
      <li><a href="/archives">文章</a></li>
    
      <li><a href="/about">關於</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-09-21T07:28:17.000Z"><a href="/2016/09/21/program-self-cultivation-ch3/">2016-09-21</a></time>
      
      
  
    <h1 class="title">程式設計師的自我修養〈目的檔〉</h1>
  

    </header>
    <div class="entry">
      
        <h2 id="目的檔格式"><a href="#目的檔格式" class="headerlink" title="目的檔格式"></a>目的檔格式</h2><p>可執行檔格式(Executable)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Windows : PE  (Portable Executable)</span><br><span class="line">Linux   : ELF (Executable Linkable Format)</span><br><span class="line">Intel   : OMF (Object Module Format)</span><br><span class="line">Unix    : .out</span><br><span class="line">DOS     : .COM</span><br></pre></td></tr></table></figure>
<p>以上都是 COFF(Common object file format) 格式的變化</p>
<p>動態連結程式庫</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Windows : .dll</span><br><span class="line">Linux   : .so</span><br></pre></td></tr></table></figure>
<p>靜態連結程式庫</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Windows : .lib</span><br><span class="line">Linux   : .a</span><br></pre></td></tr></table></figure>
<p>動態/靜態連結程式庫也是按照可執行檔格式儲存</p>
<a id="more"></a>
<h2 id="ELF-格式"><a href="#ELF-格式" class="headerlink" title="ELF 格式"></a>ELF 格式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Relocatable     File : 程式碼和資料，可連結成可執行檔(.o/.obj)</span><br><span class="line">Executable      File : 可執行的程式(/bin/bash/.exe)</span><br><span class="line">Shared Object   File : 可變為目的檔或連結其他共用目的檔和可執行檔(.so/.dll)</span><br><span class="line">Core Dump       File : 當行程意外終止時，可將行程資訊 dump(core dump)</span><br></pre></td></tr></table></figure>
<p>在 Linux 可用 <code>file</code> 指令看檔案格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ file hello.c</span><br><span class="line">hello.c: C source, ASCII text</span><br><span class="line"></span><br><span class="line">$ file hello.i</span><br><span class="line">hello.i: C source, ASCII text</span><br><span class="line"></span><br><span class="line">$ file hello.o  //目的檔也是可執行檔格式(relocatable)</span><br><span class="line">hello.o: ELF 64-bit LSB  relocatable, x86-64, version 1 (SYSV), not stripped</span><br><span class="line"></span><br><span class="line">$ file hello.s</span><br><span class="line">hello.s: assembler source text</span><br><span class="line"></span><br><span class="line">$ file /bin/bash  //可執行檔格式(executable)</span><br><span class="line">/bin/bash: ELF 64-bit LSB  executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.24</span><br><span class="line"></span><br><span class="line">$ file /lib32/ld-2.19.so  //動態連結程式庫(shared object)</span><br><span class="line">/lib32/ld-2.19.so: ELF 32-bit LSB  shared object, Intel 80386, version 1 (SYSV), dynamically linked</span><br></pre></td></tr></table></figure>
<h2 id="目的檔內容"><a href="#目的檔內容" class="headerlink" title="目的檔內容"></a>目的檔內容</h2><p>目的檔不外乎儲存編譯後的機器碼指令</p>
<p>還有連結需要的資訊(符號表、除錯資訊)</p>
<p>這些不同資訊按照屬性存在 Section 或稱為 Segment 以下稱<code>段</code></p>
<p>機器碼放在程式碼區段，此段稱為 .code 或 .text </p>
<p><code>全域變數</code>和<code>區域靜態變數</code>在資料區段，稱為 .data</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">int g_init_var  = 84;     // .data</span><br><span class="line">int g_uninit_var;         // .bss</span><br><span class="line"></span><br><span class="line">void func1(int i)         ---+</span><br><span class="line">&#123;                            |</span><br><span class="line">    printf(&quot;%d\n&quot;,i);        |--&gt; .text</span><br><span class="line">&#125;                            | </span><br><span class="line">                             |</span><br><span class="line">int main(void)               |</span><br><span class="line">&#123;                         ---+</span><br><span class="line">    static int static_var1 = 85;  // .data</span><br><span class="line">    static int static_var2;       // .bss</span><br><span class="line">     </span><br><span class="line">    int a = 1;                    ---+</span><br><span class="line">    int b;                           |</span><br><span class="line">    func1(static_var1 +              |</span><br><span class="line">          static_var2 + a + b);      |--&gt; .text</span><br><span class="line">                                     |</span><br><span class="line">    return 0;                        |</span><br><span class="line">&#125;                                 ---+</span><br></pre></td></tr></table></figure>
<p>Executable File / Object File<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 分成 4 個區塊</span><br><span class="line">File Header</span><br><span class="line">.text</span><br><span class="line">.data</span><br><span class="line">.bss</span><br></pre></td></tr></table></figure></p>
<p>目的檔可用 <code>objdump</code> 看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Usage: objdump &lt;option(s)&gt; &lt;file(s)&gt;</span><br><span class="line"> Display information from object &lt;file(s)&gt;.</span><br><span class="line"> At least one of the following switches must be given:</span><br><span class="line">  -a, --archive-headers    Display archive header information</span><br><span class="line">  -f, --file-headers       Display the contents of the overall file header</span><br><span class="line">  -p, --private-headers    Display object format specific file header contents</span><br><span class="line">  -P, --private=OPT,OPT... Display object format specific contents</span><br><span class="line">  -h, --[section-]headers  Display the contents of the section headers</span><br><span class="line">  -x, --all-headers        Display the contents of all headers</span><br><span class="line">  -d, --disassemble        Display assembler contents of executable sections</span><br><span class="line">  -D, --disassemble-all    Display assembler contents of all sections</span><br><span class="line">  -S, --source             Intermix source code with disassembly</span><br><span class="line">  -s, --full-contents      Display the full contents of all sections requested</span><br><span class="line">  -g, --debugging          Display debug information in object file</span><br><span class="line">  -e, --debugging-tags     Display debug information using ctags style</span><br><span class="line">  -G, --stabs              Display (in raw form) any STABS info in the file</span><br><span class="line">  -W[lLiaprmfFsoRt] or</span><br><span class="line">  --dwarf[=rawline,=decodedline,=info,=abbrev,=pubnames,=aranges,=macro,=frames,</span><br><span class="line">          =frames-interp,=str,=loc,=Ranges,=pubtypes,</span><br><span class="line">          =gdb_index,=trace_info,=trace_abbrev,=trace_aranges,</span><br><span class="line">          =addr,=cu_index]</span><br><span class="line">                           Display DWARF info in the file</span><br><span class="line">  -t, --syms               Display the contents of the symbol table(s)</span><br><span class="line">  -T, --dynamic-syms       Display the contents of the dynamic symbol table</span><br><span class="line">  -r, --reloc              Display the relocation entries in the file</span><br><span class="line">  -R, --dynamic-reloc      Display the dynamic relocation entries in the file</span><br><span class="line">  @&lt;file&gt;                  Read options from &lt;file&gt;</span><br><span class="line">  -v, --version            Display this program&apos;s version number</span><br><span class="line">  -i, --info               List object formats and architectures supported</span><br><span class="line">  -H, --help               Display this information</span><br></pre></td></tr></table></figure>
<p>編譯不同階段檔案格式 script<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">export file_name=&quot;objectTest&quot;</span><br><span class="line">gcc -E $file_name.c -o $file_name.i</span><br><span class="line">gcc -S $file_name.i -o $file_name.s</span><br><span class="line">gcc -c $file_name.s -o $file_name.o</span><br></pre></td></tr></table></figure></p>
<p>不同程式碼編譯後存放的位址如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">機器碼                          -&gt; .text</span><br><span class="line">全域變數/區域靜態變數(初始化)   -&gt; .data</span><br><span class="line">全域變數/區域靜態變數(未初始化) -&gt; .bss</span><br></pre></td></tr></table></figure>
<p>bss 只是為初始化的全域變數/區域靜態變數預留位置，他沒有內容</p>
<p>所以在檔案中不占空間</p>
<p>程式指令和資料分開放比較好，主要優點如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.程式載入後，指令和資料對應 2 個虛擬記憶體空間</span><br><span class="line">資料區段是 R/W，指令區段是 R，所以這樣可以保護指令不會被惡意改寫</span><br><span class="line"></span><br><span class="line">2.分開放可以加強 CPU 快取命中率</span><br><span class="line"></span><br><span class="line">3.如果執行相同程式，因為指令是一樣的所以可以共用，當然資料區段是各自擁有的</span><br></pre></td></tr></table></figure>
<h2 id="挖掘-Section"><a href="#挖掘-Section" class="headerlink" title="挖掘 Section"></a>挖掘 Section</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">// 使用 objdump 來看 headers，還有個工具 readelf 也可使用</span><br><span class="line">objdump -h SimpleSection.o</span><br><span class="line"></span><br><span class="line">SimpleSection.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line">Sections:</span><br><span class="line">Idx Name            Size      VMA               LMA               File off  Algn</span><br><span class="line">  0 .text           00000056  0000000000000000  0000000000000000  00000040  2**0</span><br><span class="line">                    CONTENTS, ALLOC, LOAD, RELOC, READONLY, CODE</span><br><span class="line">  1 .data           00000008  0000000000000000  0000000000000000  00000098  2**2</span><br><span class="line">                    CONTENTS, ALLOC, LOAD, DATA</span><br><span class="line">  2 .bss            00000004  0000000000000000  0000000000000000  000000a0  2**2</span><br><span class="line">                    ALLOC</span><br><span class="line">  3 .rodata         00000004  0000000000000000  0000000000000000  000000a0  2**0</span><br><span class="line">                    CONTENTS, ALLOC, LOAD, READONLY, DATA</span><br><span class="line">  4 .comment        0000002c  0000000000000000  0000000000000000  000000a4  2**0</span><br><span class="line">                    CONTENTS, READONLY</span><br><span class="line">  5 .note.GNU-stack 00000000  0000000000000000  0000000000000000  000000d0  2**0</span><br><span class="line">                    CONTENTS, READONLY</span><br><span class="line">  6 .eh_frame       00000058  0000000000000000  0000000000000000  000000d0  2**3</span><br><span class="line">                    CONTENTS, ALLOC, LOAD, RELOC, READONLY, DATA</span><br><span class="line">                    </span><br><span class="line">// readelf Header                  </span><br><span class="line">readelf -h SimpleSection.o</span><br><span class="line">ELF Header:</span><br><span class="line">  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00</span><br><span class="line">  Class:                             ELF64</span><br><span class="line">  Data:                              2&apos;s complement, little endian</span><br><span class="line">  Version:                           1 (current)</span><br><span class="line">  OS/ABI:                            UNIX - System V</span><br><span class="line">  ABI Version:                       0</span><br><span class="line">  Type:                              REL (Relocatable file)</span><br><span class="line">  Machine:                           Advanced Micro Devices X86-64</span><br><span class="line">  Version:                           0x1</span><br><span class="line">  Entry point address:               0x0</span><br><span class="line">  Start of program headers:          0 (bytes into file)</span><br><span class="line">  Start of section headers:          400 (bytes into file)</span><br><span class="line">  Flags:                             0x0</span><br><span class="line">  Size of this header:               64 (bytes)</span><br><span class="line">  Size of program headers:           0 (bytes)</span><br><span class="line">  Number of program headers:         0</span><br><span class="line">  Size of section headers:           64 (bytes)</span><br><span class="line">  Number of section headers:         13</span><br><span class="line">  Section header string table index: 10</span><br><span class="line"></span><br><span class="line">// readelf Section </span><br><span class="line">readelf -S SimpleSection.o</span><br><span class="line">There are 13 section headers, starting at offset 0x190:</span><br><span class="line"></span><br><span class="line">Section Headers:</span><br><span class="line">  [Nr] Name              Type             Address           Offset</span><br><span class="line">       Size              EntSize          Flags  Link  Info  Align</span><br><span class="line">  [ 0]                   NULL             0000000000000000  00000000</span><br><span class="line">       0000000000000000  0000000000000000           0     0     0</span><br><span class="line">  [ 1] .text             PROGBITS         0000000000000000  00000040</span><br><span class="line">       0000000000000056  0000000000000000  AX       0     0     1</span><br><span class="line">  [ 2] .rela.text        RELA             0000000000000000  000006b0</span><br><span class="line">       0000000000000078  0000000000000018          11     1     8</span><br><span class="line">  [ 3] .data             PROGBITS         0000000000000000  00000098</span><br><span class="line">       0000000000000008  0000000000000000  WA       0     0     4</span><br><span class="line">  [ 4] .bss              NOBITS           0000000000000000  000000a0</span><br><span class="line">       0000000000000004  0000000000000000  WA       0     0     4</span><br><span class="line">  [ 5] .rodata           PROGBITS         0000000000000000  000000a0</span><br><span class="line">       0000000000000004  0000000000000000   A       0     0     1</span><br><span class="line">  [ 6] .comment          PROGBITS         0000000000000000  000000a4</span><br><span class="line">       000000000000002c  0000000000000001  MS       0     0     1</span><br><span class="line">  [ 7] .note.GNU-stack   PROGBITS         0000000000000000  000000d0</span><br><span class="line">       0000000000000000  0000000000000000           0     0     1</span><br><span class="line">  [ 8] .eh_frame         PROGBITS         0000000000000000  000000d0</span><br><span class="line">       0000000000000058  0000000000000000   A       0     0     8</span><br><span class="line">  [ 9] .rela.eh_frame    RELA             0000000000000000  00000728</span><br><span class="line">       0000000000000030  0000000000000018          11     8     8</span><br><span class="line">  [10] .shstrtab         STRTAB           0000000000000000  00000128</span><br><span class="line">       0000000000000061  0000000000000000           0     0     1</span><br><span class="line">  [11] .symtab           SYMTAB           0000000000000000  000004d0</span><br><span class="line">       0000000000000180  0000000000000018          12    11     8</span><br><span class="line">  [12] .strtab           STRTAB           0000000000000000  00000650</span><br><span class="line">       000000000000005d  0000000000000000           0     0     1</span><br><span class="line">Key to Flags:</span><br><span class="line">  W (write), A (alloc), X (execute), M (merge), S (strings), l (large)</span><br><span class="line">  I (info), L (link order), G (group), T (TLS), E (exclude), x (unknown)</span><br><span class="line">  O (extra OS processing required) o (OS specific), p (processor specific)</span><br></pre></td></tr></table></figure>
<p>我們可以發現有許多不同的 Section</p>
<p>除了原本的 .text、.data、.bss，還多了 .rodata(唯讀資料區段)</p>
<p>.coment(註釋區段)、note.GUN-stack(堆疊提示區段)</p>
<p>再來看區段屬性，CONTENTS 表示此區段在檔案中存在</p>
<p>BSS 沒有 CONTENTS，表示他在 ELF 不存在內容</p>
<p>note.GUN-stack 雖然有 CONTENTS，但長度是 0</p>
<p>根據 Header 結構如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ ls -al</span><br><span class="line">-rw-rw-r--  1 jason.cc.chiu jason.cc.chiu  1880  9月 22 13:22 SimpleSection.o</span><br><span class="line">$ size SimpleSection.o</span><br><span class="line">   text    data     bss     dec     hex filename</span><br><span class="line">    178       8       4     190      be SimpleSection.o</span><br><span class="line"></span><br><span class="line">        +----------------+ 0x0000_0758</span><br><span class="line">  0x688 |   Other data   |        </span><br><span class="line">        +----------------+ 0x0000_00d0</span><br><span class="line">  0x2c  |   .commnt      |                     </span><br><span class="line">        +----------------+ 0x0000_00a4</span><br><span class="line">  0x04  |   .rodata      | </span><br><span class="line">        +----------------+ 0x0000_00a0</span><br><span class="line">  0x08  |   .data        |                                           </span><br><span class="line">        +----------------+ 0x0000_0098</span><br><span class="line">  0x56  |   .text        |        </span><br><span class="line">        +----------------+ 0x0000_0040</span><br><span class="line">  0x40  |   ELF Header   |</span><br><span class="line">        +----------------+ 0x0000_0000</span><br></pre></td></tr></table></figure>
<p>使用 objdump 來看區段內容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">// -d 是將指令區段顯示出來</span><br><span class="line">objdump -s -d SimpleSection.o</span><br><span class="line"></span><br><span class="line">SimpleSection.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line">Contents of section .text: // Size = 0x56</span><br><span class="line"> 0000 554889e5 4883ec10 897dfc8b 45fc89c6  UH..H....&#125;..E...</span><br><span class="line"> 0010 bf000000 00b80000 0000e800 000000c9  ................</span><br><span class="line"> 0020 c3554889 e54883ec 10c745f8 01000000  .UH..H....E.....</span><br><span class="line"> 0030 8b150000 00008b05 00000000 01c28b45  ...............E</span><br><span class="line"> 0040 f801c28b 45fc01d0 89c7e800 000000b8  ....E...........</span><br><span class="line"> 0050 00000000 c9c3                        ......</span><br><span class="line">Contents of section .data:</span><br><span class="line"> 0000 54000000 55000000                    T...U...</span><br><span class="line">Contents of section .rodata:</span><br><span class="line"> 0000 25640a00                             %d..</span><br><span class="line">Contents of section .comment:</span><br><span class="line"> 0000 00474343 3a202855 62756e74 7520342e  .GCC: (Ubuntu 4.</span><br><span class="line"> 0010 382e342d 32756275 6e747531 7e31342e  8.4-2ubuntu1~14.</span><br><span class="line"> 0020 30342e33 2920342e 382e3400           04.3) 4.8.4.</span><br><span class="line">Contents of section .eh_frame:</span><br><span class="line"> 0000 14000000 00000000 017a5200 01781001  .........zR..x..</span><br><span class="line"> 0010 1b0c0708 90010000 1c000000 1c000000  ................</span><br><span class="line"> 0020 00000000 21000000 00410e10 8602430d  ....!....A....C.</span><br><span class="line"> 0030 065c0c07 08000000 1c000000 3c000000  .\..........&lt;...</span><br><span class="line"> 0040 00000000 35000000 00410e10 8602430d  ....5....A....C.</span><br><span class="line"> 0050 06700c07 08000000                    .p......</span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">0000000000000000 &lt;func1&gt;:</span><br><span class="line">   0:   55                      push   %rbp</span><br><span class="line">   1:   48 89 e5                mov    %rsp,%rbp</span><br><span class="line">   4:   48 83 ec 10             sub    $0x10,%rsp</span><br><span class="line">   8:   89 7d fc                mov    %edi,-0x4(%rbp)</span><br><span class="line">   b:   8b 45 fc                mov    -0x4(%rbp),%eax</span><br><span class="line">   e:   89 c6                   mov    %eax,%esi</span><br><span class="line">  10:   bf 00 00 00 00          mov    $0x0,%edi</span><br><span class="line">  15:   b8 00 00 00 00          mov    $0x0,%eax</span><br><span class="line">  1a:   e8 00 00 00 00          callq  1f &lt;func1+0x1f&gt;</span><br><span class="line">  1f:   c9                      leaveq</span><br><span class="line">  20:   c3                      retq</span><br><span class="line"></span><br><span class="line">0000000000000021 &lt;main&gt;:</span><br><span class="line">  21:   55                      push   %rbp</span><br><span class="line">  22:   48 89 e5                mov    %rsp,%rbp</span><br><span class="line">  25:   48 83 ec 10             sub    $0x10,%rsp</span><br><span class="line">  29:   c7 45 f8 01 00 00 00    movl   $0x1,-0x8(%rbp)</span><br><span class="line">  30:   8b 15 00 00 00 00       mov    0x0(%rip),%edx        # 36 &lt;main+0x15&gt;</span><br><span class="line">  36:   8b 05 00 00 00 00       mov    0x0(%rip),%eax        # 3c &lt;main+0x1b&gt;</span><br><span class="line">  3c:   01 c2                   add    %eax,%edx</span><br><span class="line">  3e:   8b 45 f8                mov    -0x8(%rbp),%eax</span><br><span class="line">  41:   01 c2                   add    %eax,%edx</span><br><span class="line">  43:   8b 45 fc                mov    -0x4(%rbp),%eax</span><br><span class="line">  46:   01 d0                   add    %edx,%eax</span><br><span class="line">  48:   89 c7                   mov    %eax,%edi</span><br><span class="line">  4a:   e8 00 00 00 00          callq  4f &lt;main+0x2e&gt;</span><br><span class="line">  4f:   b8 00 00 00 00          mov    $0x0,%eax</span><br><span class="line">  54:   c9                      leaveq</span><br><span class="line">  55:   c3                      retq</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"> /*  </span><br><span class="line"> 0000 55 ......</span><br><span class="line"> 0050 ...... c3    </span><br><span class="line"> 可以看出 55 是 func1 第 1 個 byte</span><br><span class="line"> 最後面 c3 是 main 最後 1 個 byte</span><br><span class="line"> */</span><br></pre></td></tr></table></figure>
<h2 id="資料區段和唯讀資料區段"><a href="#資料區段和唯讀資料區段" class="headerlink" title="資料區段和唯讀資料區段"></a>資料區段和唯讀資料區段</h2><p>資料區段 .data 儲存初始化的全域變數和靜態區域變數</p>
<p>前面程式碼中有兩個存在此區段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int g_init_var  = 84;</span><br><span class="line">static int static_var1 = 85;</span><br></pre></td></tr></table></figure>
<p>int 類型大小為 4 byte，所以 2 個變數為 8 byte</p>
<p>所以 .data 的 size 為 8 byte</p>
<p>printf 用到 <code>&quot;%d\n&quot;</code> 為字串常數，是唯讀資料</p>
<p>放在 .rodata，4 個 byte</p>
<p>.rodata 放唯讀資料，如 const 變數和字串常數</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Contents of section .rodata:</span><br><span class="line"> 0000 25640a00                             %d..</span><br><span class="line"> </span><br><span class="line"> 0x25 = %</span><br><span class="line"> 0x64 = d</span><br><span class="line"> 0x0a</span><br><span class="line"> 0x00 = 0</span><br></pre></td></tr></table></figure>
<p>再來用 objdump 看看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Sections:</span><br><span class="line">Idx Name          Size      VMA               LMA               File off  Algn</span><br><span class="line">  1 .data         00000008  0000000000000000  0000000000000000  00000098  2**2</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, DATA</span><br><span class="line">  3 .rodata       00000004  0000000000000000  0000000000000000  000000a0  2**0</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, READONLY, DATA</span><br><span class="line">                  </span><br><span class="line">Contents of section .data:</span><br><span class="line"> 0000 54000000 55000000                    T...U...</span><br><span class="line">Contents of section .rodata:</span><br><span class="line"> 0000 25640a00                             %d..</span><br></pre></td></tr></table></figure>
<p>.data 前 4 byte = 54 00 00 00  = 84(10進位)</p>
<p>對應 <code>int g_init_var  = 84;</code></p>
<p>.data 後 4 byte = 55 00 00 00  = 85(10進位)</p>
<p>對應 <code>static int static_var1 = 85;</code></p>
<p>而為什麼順序是 54 00 00 00 不是  00 00 00 54 ?</p>
<p>是關係到 CPU 的 byte order </p>
<h2 id="BSS"><a href="#BSS" class="headerlink" title="BSS"></a>BSS</h2><p>BSS 存放位初始化的全域變數和靜態區域變數</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int g_uninit_var;</span><br><span class="line">static int static_var2;</span><br></pre></td></tr></table></figure>
<p>兩個變數理論要 8 byte size 但 bss 只有 4 byte</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2 .bss            00000004</span><br></pre></td></tr></table></figure>
<p>我們可以透過符號表看到，只有 static_var2 有存入 bss</p>
<p>g_uninit_var 為未定義的 COMMON 符號</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SYMBOL TABLE:</span><br><span class="line">......</span><br><span class="line">0000000000000004 l     O .data  0000000000000004 static_var1.2184</span><br><span class="line">0000000000000000 l     O .bss   0000000000000004 static_var2.2185</span><br><span class="line">0000000000000000 l    d  .note.GNU-stack        0000000000000000 .note.GNU-stack</span><br><span class="line">......</span><br><span class="line">0000000000000004       O *COM*  0000000000000004 g_uninit_var</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>要注意的是初始化指派為 0 的變數還是會放在 BSS ，例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sataic int x1 = 0;</span><br><span class="line">sataic int x2 = 1;</span><br></pre></td></tr></table></figure>
<p>x1 放 .bss 而 x2 放 .data，因為指派 0 會被認定還未初始化</p>
<p>最佳化後會放在 .bss，這樣可以節省空間</p>
<h2 id="其他區段"><a href="#其他區段" class="headerlink" title="其他區段"></a>其他區段</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.rodatel    : 唯讀資料</span><br><span class="line">.comment    : 編譯器資訊</span><br><span class="line">.debug      : 除錯資訊</span><br><span class="line">.dynamic    : 動態連結資訊</span><br><span class="line">.hash       : 符號雜湊表</span><br><span class="line">.line       : 除錯行號表</span><br><span class="line">.note       : 額外編譯器資訊</span><br><span class="line">.strtab </span><br><span class="line">.symtab</span><br><span class="line">.shstrtab</span><br><span class="line">.plt</span><br><span class="line">.got</span><br><span class="line">.init</span><br><span class="line">.fini</span><br></pre></td></tr></table></figure>
<h2 id="將檔案作為目的檔區段"><a href="#將檔案作為目的檔區段" class="headerlink" title="將檔案作為目的檔區段"></a>將檔案作為目的檔區段</h2><p>我們要將一個 size 為 0x48D 的 image.jpg 作為目的檔中的一個區段</p>
<p><a href="http://www.cmlab.csie.ntu.edu.tw/~daniel/linux/objcopy.html" target="_blank" rel="external">可參考</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 將 image.jpg 轉為 image.o</span><br><span class="line">$ objcopy -I binary -O elf64-x86-64 -B i386 image.jpg image.o</span><br><span class="line">$ objdump -ht image.o</span><br><span class="line">image.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line">Sections:</span><br><span class="line">Idx Name          Size      VMA               LMA               File off  Algn</span><br><span class="line">  0 .data         0000048d  0000000000000000  0000000000000000  00000040  2**0</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, DATA</span><br><span class="line">SYMBOL TABLE:</span><br><span class="line">0000000000000000 l    d  .data  0000000000000000 .data</span><br><span class="line">0000000000000000 g       .data  0000000000000000 _binary_image_jpg_start</span><br><span class="line">000000000000048d g       .data  0000000000000000 _binary_image_jpg_end</span><br><span class="line">000000000000048d g       *ABS*  0000000000000000 _binary_image_jpg_size</span><br></pre></td></tr></table></figure>
<p>現在可以在程式中直接宣告並使用</p>
<p>一般 GCC 編譯原始檔後，會把程式碼放到 .text，全域變數和靜態變數放 .data 和 .bss</p>
<p>GCC 提供一中方法可以讓你將變數、方法放到指定的區段</p>
<p><code>__attribute__((section(&quot;SectionName&quot;)))</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int g_init_var  = 84;     </span><br><span class="line">int g_uninit_var;         </span><br><span class="line">__attribute__((section(&quot;FOO&quot;))) int g_foo  = 42;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void func1(int i)        </span><br><span class="line">&#123;                            </span><br><span class="line">    printf(&quot;%d\n&quot;,i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__attribute__((section(&quot;BAR&quot;))) void func_bar()</span><br><span class="line">&#123;                            </span><br><span class="line">    printf(&quot;func_bar\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;                        </span><br><span class="line">    static int static_var1 = 85;  // .data</span><br><span class="line">    static int static_var2;       // .bss</span><br><span class="line">     </span><br><span class="line">    int a = 1;</span><br><span class="line">    int b;  </span><br><span class="line">    func1(static_var1 + static_var2 + a + b);</span><br><span class="line">    return 0;                        </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">objdump -ht SimpleSection.o</span><br><span class="line"></span><br><span class="line">SimpleSection.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line">Sections:</span><br><span class="line">Idx Name          Size      VMA               LMA               File off  Algn</span><br><span class="line">  3 FOO           00000004  0000000000000000  0000000000000000  000000a0  2**2</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, DATA</span><br><span class="line"></span><br><span class="line">  5 BAR           00000010  0000000000000000  0000000000000000  000000b1  2**0</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, CODE</span><br><span class="line"></span><br><span class="line">0000000000000000 l    d  FOO    0000000000000000 FOO</span><br><span class="line">0000000000000000 l    d  BAR    0000000000000000 BAR</span><br></pre></td></tr></table></figure>
<h2 id="ELF-結構描述"><a href="#ELF-結構描述" class="headerlink" title="ELF 結構描述"></a>ELF 結構描述</h2><p>目前 ELF 結構如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+</span><br><span class="line">|     ELF Header      |</span><br><span class="line">+---------------------+</span><br><span class="line">|       .text         |</span><br><span class="line">+---------------------+</span><br><span class="line">|       .data         |</span><br><span class="line">+---------------------+</span><br><span class="line">|       .bss          |</span><br><span class="line">+---------------------+</span><br><span class="line">|       ....          |</span><br><span class="line">+---------------------+</span><br><span class="line">|  Section Header TLB |</span><br><span class="line">+---------------------+</span><br><span class="line">|     String TLB      |</span><br><span class="line">+---------------------+</span><br><span class="line">|     Symbol TLB      |</span><br><span class="line">+---------------------+</span><br></pre></td></tr></table></figure>
<p>先看<code>ELF Header</code> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">$ readelf -h SimpleSection.o</span><br><span class="line">ELF Header:</span><br><span class="line">  # 魔數</span><br><span class="line">  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00   </span><br><span class="line">  # 檔案機器位元長度</span><br><span class="line">  Class:                             ELF64  </span><br><span class="line">  # 資料儲存方式</span><br><span class="line">  Data:                              2&apos;s complement, little endian  </span><br><span class="line">  # 版本</span><br><span class="line">  Version:                           1 (current)  </span><br><span class="line">  # 執行平台</span><br><span class="line">  OS/ABI:                            UNIX - System V</span><br><span class="line">  # ABI 版本</span><br><span class="line">  ABI Version:                       0</span><br><span class="line">  # ELF 重定類型</span><br><span class="line">  Type:                              REL (Relocatable file)</span><br><span class="line">  # 硬體平台</span><br><span class="line">  Machine:                           Advanced Micro Devices X86-64</span><br><span class="line">  # 硬體平台版本</span><br><span class="line">  Version:                           0x1</span><br><span class="line">  # 入口位址</span><br><span class="line">  Entry point address:               0x0</span><br><span class="line">  # 程式標頭入口和長度、段頭表的位址和長度、區段數量</span><br><span class="line">  Start of program headers:          0 (bytes into file)</span><br><span class="line">  Start of section headers:          400 (bytes into file)</span><br><span class="line">  Flags:                             0x0</span><br><span class="line">  Size of this header:               64 (bytes)</span><br><span class="line">  Size of program headers:           0 (bytes)</span><br><span class="line">  Number of program headers:         0</span><br><span class="line">  Size of section headers:           64 (bytes)</span><br><span class="line">  Number of section headers:         13</span><br><span class="line">  Section header string table index: 10</span><br></pre></td></tr></table></figure>
<p>ELF 檔案在各平台下通用，ELF 分為 32 和 64 位元兩種版本</p>
<p>可參考<code>/usr/include/elf.h</code></p>
<p>例如如果是 32 位元，Elf32_Addr = uint32_t = 4 byte</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"> 30 /* Type for a 16-bit quantity.  */</span><br><span class="line"> 31 typedef uint16_t Elf32_Half;</span><br><span class="line"> 32 typedef uint16_t Elf64_Half;</span><br><span class="line"> 33</span><br><span class="line"> 34 /* Types for signed and unsigned 32-bit quantities.  */</span><br><span class="line"> 35 typedef uint32_t Elf32_Word;</span><br><span class="line"> 36 typedef int32_t  Elf32_Sword;</span><br><span class="line"> 37 typedef uint32_t Elf64_Word;</span><br><span class="line"> 38 typedef int32_t  Elf64_Sword;</span><br><span class="line"> 39</span><br><span class="line"> 40 /* Types for signed and unsigned 64-bit quantities.  */</span><br><span class="line"> 41 typedef uint64_t Elf32_Xword;</span><br><span class="line"> 42 typedef int64_t  Elf32_Sxword;</span><br><span class="line"> 43 typedef uint64_t Elf64_Xword;</span><br><span class="line"> 44 typedef int64_t  Elf64_Sxword;</span><br><span class="line"> 45</span><br><span class="line"> 46 /* Type of addresses.  */</span><br><span class="line"> 47 typedef uint32_t Elf32_Addr;</span><br><span class="line"> 48 typedef uint64_t Elf64_Addr;</span><br><span class="line"> 49</span><br><span class="line"> 50 /* Type of file offsets.  */</span><br><span class="line"> 51 typedef uint32_t Elf32_Off;</span><br><span class="line"> 52 typedef uint64_t Elf64_Off;</span><br><span class="line"> 53</span><br><span class="line"> 54 /* Type for section indices, which are 16-bit quantities.  */</span><br><span class="line"> 55 typedef uint16_t Elf32_Section;</span><br><span class="line"> 56 typedef uint16_t Elf64_Section;</span><br><span class="line"> 57</span><br><span class="line"> 58 /* Type for version symbol information.  */</span><br><span class="line"> 59 typedef Elf32_Half Elf32_Versym;</span><br><span class="line"> 60 typedef Elf64_Half Elf64_Versym;</span><br><span class="line"></span><br><span class="line"> 67 typedef struct</span><br><span class="line"> 68 &#123;</span><br><span class="line"> 69   unsigned char e_ident[EI_NIDENT];    /* Magic number and other info */</span><br><span class="line"> 70   Elf32_Half    e_type;                /* Object file type */</span><br><span class="line"> 71   Elf32_Half    e_machine;             /* Architecture */</span><br><span class="line"> 72   Elf32_Word    e_version;             /* Object file version */</span><br><span class="line"> 73   Elf32_Addr    e_entry;               /* Entry point virtual address */</span><br><span class="line"> 74   Elf32_Off e_phoff;                   /* Program header table file offset */</span><br><span class="line"> 75   Elf32_Off e_shoff;                   /* Section header table file offset */</span><br><span class="line"> 76   Elf32_Word    e_flags;               /* Processor-specific flags */</span><br><span class="line"> 77   Elf32_Half    e_ehsize;              /* ELF header size in bytes */</span><br><span class="line"> 78   Elf32_Half    e_phentsize;           /* Program header table entry size */</span><br><span class="line"> 79   Elf32_Half    e_phnum;               /* Program header table entry count */</span><br><span class="line"> 80   Elf32_Half    e_shentsize;           /* Section header table entry size */</span><br><span class="line"> 81   Elf32_Half    e_shnum;               /* Section header table entry count */</span><br><span class="line"> 82   Elf32_Half    e_shstrndx;            /* Section header string table index */</span><br><span class="line"> 83 &#125; Elf32_Ehdr;  </span><br><span class="line"> 84</span><br><span class="line"> 85 typedef struct</span><br><span class="line"> 86 &#123;</span><br><span class="line"> 87   unsigned char e_ident[EI_NIDENT];    /* Magic number and other info */</span><br><span class="line"> 88   Elf64_Half    e_type;                /* Object file type */</span><br><span class="line"> 89   Elf64_Half    e_machine;             /* Architecture */</span><br><span class="line"> 90   Elf64_Word    e_version;             /* Object file version */</span><br><span class="line"> 91   Elf64_Addr    e_entry;               /* Entry point virtual address */</span><br><span class="line"> 92   Elf64_Off e_phoff;                   /* Program header table file offset */</span><br><span class="line"> 93   Elf64_Off e_shoff;                   /* Section header table file offset */</span><br><span class="line"> 94   Elf64_Word    e_flags;               /* Processor-specific flags */</span><br><span class="line"> 95   Elf64_Half    e_ehsize;              /* ELF header size in bytes */</span><br><span class="line"> 96   Elf64_Half    e_phentsize;           /* Program header table entry size */</span><br><span class="line"> 97   Elf64_Half    e_phnum;               /* Program header table entry count */</span><br><span class="line"> 98   Elf64_Half    e_shentsize;           /* Section header table entry size */</span><br><span class="line"> 99   Elf64_Half    e_shnum;               /* Section header table entry count */</span><br><span class="line">100   Elf64_Half    e_shstrndx;            /* Section header string table index */</span><br><span class="line">101 &#125; Elf64_Ehdr;</span><br></pre></td></tr></table></figure>
<p>可以看出 ELF Header 符合 Elf(32/64)_Ehdr 結構的定義</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># EI_NIDENT (16)</span><br><span class="line"></span><br><span class="line">ELF Header:</span><br><span class="line">  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00          /* e_ident[EI_NIDENT];*/</span><br><span class="line">  Class:                             ELF64                          /* e_ident[EI_NIDENT];*/</span><br><span class="line">  Data:                              2&apos;s complement, little endian  /* e_ident[EI_NIDENT];*/</span><br><span class="line">  Version:                           1 (current)                    /* e_ident[EI_NIDENT];*/</span><br><span class="line">  OS/ABI:                            UNIX - System V                /* e_ident[EI_NIDENT];*/</span><br><span class="line">  ABI Version:                       0                              /* e_ident[EI_NIDENT];*/</span><br><span class="line">  Type:                              REL (Relocatable file)         /* e_type */</span><br><span class="line">  Machine:                           Advanced Micro Devices X86-64  /* e_machine */</span><br><span class="line">  Version:                           0x1                            /* e_version */</span><br><span class="line">  Entry point address:               0x0                            /* e_entry */</span><br><span class="line">  Start of program headers:          0 (bytes into file)            /* e_phoff */</span><br><span class="line">  Start of section headers:          400 (bytes into file)          /* e_shoff */</span><br><span class="line">  Flags:                             0x0                            /* e_flags */</span><br><span class="line">  Size of this header:               64 (bytes)                     /* e_ehsize */</span><br><span class="line">  Size of program headers:           0 (bytes)                      /* e_phentsize */</span><br><span class="line">  Number of program headers:         0                              /* e_phnum */</span><br><span class="line">  Size of section headers:           64 (bytes)                     /* e_shentsize */</span><br><span class="line">  Number of section headers:         13                             /* e_shnum */</span><br><span class="line">  Section header string table index: 10                             /* e_shstrndx */</span><br></pre></td></tr></table></figure>
<h2 id="魔數-Magic"><a href="#魔數-Magic" class="headerlink" title="魔數(Magic)"></a>魔數(Magic)</h2><p>Magic 為 16 byte，用來標示 ELF 平台屬性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 一般可執行檔前面幾個 byte 為魔數</span><br><span class="line"># OS 在載入執行檔前會先檢查魔數是否正確</span><br><span class="line">7f = DEL</span><br><span class="line">45 = E</span><br><span class="line">4c = L</span><br><span class="line">46 = F</span><br><span class="line"></span><br><span class="line"># ELF 檔案格式</span><br><span class="line"># 0 = 無效</span><br><span class="line"># 1 = 32 位元 </span><br><span class="line"># 2 = 64 位元</span><br><span class="line">02 </span><br><span class="line"></span><br><span class="line"># Byte Order</span><br><span class="line"># 0 = 無效</span><br><span class="line"># 1 = 小端 </span><br><span class="line"># 2 = 大端</span><br><span class="line">01 </span><br><span class="line"></span><br><span class="line"># ELF 版本</span><br><span class="line">01 </span><br><span class="line"></span><br><span class="line"># 後面目前無定義</span><br><span class="line">00 00 00 00 00 00 00 00 00</span><br></pre></td></tr></table></figure>
<p>Byte Order 為位元組順序，Endian 源自格列佛遊記</p>
<p>小人國對吃水煮蛋分兩派，一派為要從大頭先敲開(Big Endian)</p>
<p>一派為要從小頭先敲開(Little Endian)，為此常常發生內戰</p>
<p>MSB 是 Most Significant Bit/Byte </p>
<p>代表最重要的位元/位元組，他表示在一個 bit/byte 中對順序取值影響最大的那個 bit/byte </p>
<p>LSB 是 Least Significant Bit/Byte 和 MSB 相反</p>
<p>也就是在一個 bit/byte 中對順序取值影響最小的那個 bit/byte </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">例如: 0x12345678</span><br><span class="line">0x12 0x34 0x56 0x78</span><br><span class="line">0x12 = MSB</span><br><span class="line">0X78 = LSB</span><br><span class="line"></span><br><span class="line">如果單看 0x78 = 0111 1000</span><br><span class="line">最左邊 bit = 0 = MSB</span><br><span class="line">最又邊 bit = 0 = LSB</span><br></pre></td></tr></table></figure>
<p>bit-endian 規定</p>
<p>MSB 儲存時放在低位址，傳輸時放在資料流開始</p>
<p>LSB 儲存時放在高位址，傳輸時放在資料流結尾</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">            Big     Little</span><br><span class="line">0 byte      0x12    0x78</span><br><span class="line">1 byte      0x34    0x56</span><br><span class="line">2 byte      0x56    0x34</span><br><span class="line">3 byte      0x78    0x21</span><br></pre></td></tr></table></figure>
<h2 id="檔案類型-Type"><a href="#檔案類型-Type" class="headerlink" title="檔案類型(Type)"></a>檔案類型(Type)</h2><p>OS 透過此欄位判斷檔案類型，而不是透過副檔名，</p>
<p>檔案類型為常數，以<code>ET</code>開頭</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    /* Legal values for e_type (object file type).  */</span><br><span class="line">162 #define ET_NONE     0              /* No file type */</span><br><span class="line">163 #define ET_REL      1              /* Relocatable file */</span><br><span class="line">164 #define ET_EXEC     2              /* Executable file */</span><br><span class="line">165 #define ET_DYN      3              /* Shared object file */</span><br><span class="line">166 #define ET_CORE     4              /* Core file */</span><br><span class="line">167 #define ET_NUM      5              /* Number of defined types */</span><br><span class="line">168 #define ET_LOOS     0xfe00         /* OS-specific range start */</span><br><span class="line">169 #define ET_HIOS     0xfeff         /* OS-specific range end */</span><br><span class="line">170 #define ET_LOPROC   0xff00         /* Processor-specific range start */</span><br><span class="line">171 #define ET_HIPROC   0xffff         /* Processor-specific range end */</span><br></pre></td></tr></table></figure>
<h2 id="機器類型-Machine"><a href="#機器類型-Machine" class="headerlink" title="機器類型(Machine)"></a>機器類型(Machine)</h2><p>此欄位表示可在哪個平台使用，例如 Advanced Micro Devices X86-64 就是能在 x86 下使用</p>
<p>相關常數以<code>EM</code> 開頭</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">173 /* Legal values for e_machine (architecture).  */</span><br><span class="line">174</span><br><span class="line">175 #define EM_NONE      0         /* No machine */</span><br><span class="line">176 #define EM_M32       1         /* AT&amp;T WE 32100 */</span><br><span class="line">177 #define EM_SPARC     2         /* SUN SPARC */</span><br><span class="line">178 #define EM_386       3         /* Intel 80386 */</span><br><span class="line">179 #define EM_68K       4         /* Motorola m68k family */</span><br><span class="line">180 #define EM_88K       5         /* Motorola m88k family */</span><br><span class="line">181 #define EM_860       7         /* Intel 80860 */</span><br><span class="line">182 #define EM_MIPS      8         /* MIPS R3000 big-endian */</span><br><span class="line">183 #define EM_S370      9         /* IBM System/370 */</span><br><span class="line">184 #define EM_MIPS_RS3_LE  10     /* MIPS R3000 little-endian */</span><br><span class="line">186 #define EM_PARISC   15         /* HPPA */</span><br><span class="line">187 #define EM_VPP500   17         /* Fujitsu VPP500 */</span><br><span class="line">188 #define EM_SPARC32PLUS  18     /* Sun&apos;s &quot;v8plus&quot; */</span><br><span class="line">189 #define EM_960      19         /* Intel 80960 */</span><br><span class="line">190 #define EM_PPC      20         /* PowerPC */</span><br><span class="line">191 #define EM_PPC64    21         /* PowerPC 64-bit */</span><br><span class="line">192 #define EM_S390     22         /* IBM S390 */</span><br><span class="line">194 #define EM_V800     36         /* NEC V800 series */</span><br><span class="line">195 #define EM_FR20     37         /* Fujitsu FR20 */</span><br><span class="line">196 #define EM_RH32     38         /* TRW RH-32 */</span><br><span class="line">197 #define EM_RCE      39         /* Motorola RCE */</span><br><span class="line">198 #define EM_ARM      40         /* ARM */</span><br><span class="line">省略......</span><br></pre></td></tr></table></figure>
<h2 id="段頭表-Start-of-section-headers"><a href="#段頭表-Start-of-section-headers" class="headerlink" title="段頭表(Start of section headers)"></a>段頭表(Start of section headers)</h2><p>段頭表描述 ELF 個區段的資訊，如區段的區段名稱、區段長度</p>
<p>檔案中的偏移、R/W 權限、其他屬性</p>
<p>編譯器、連結器、載入器都是依靠此表決定定位和存取各區段屬性</p>
<p>範例位於 400 = 0x190 的偏移位址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"># objdump 只會顯示關鍵的區段</span><br><span class="line">$ objdump -h SimpleSection.o</span><br><span class="line"></span><br><span class="line">SimpleSection.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line">Sections:</span><br><span class="line">Idx Name          Size      VMA               LMA               File off  Algn</span><br><span class="line">  0 .text         00000056  0000000000000000  0000000000000000  00000040  2**0</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, CODE</span><br><span class="line">  1 .data         00000008  0000000000000000  0000000000000000  00000098  2**2</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, DATA</span><br><span class="line">  2 .bss          00000004  0000000000000000  0000000000000000  000000a0  2**2</span><br><span class="line">                  ALLOC</span><br><span class="line">  3 .rodata       00000004  0000000000000000  0000000000000000  000000a0  2**0</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, READONLY, DATA</span><br><span class="line">  4 .comment      0000002c  0000000000000000  0000000000000000  000000a4  2**0</span><br><span class="line">                  CONTENTS, READONLY</span><br><span class="line">  5 .note.GNU-stack 00000000  0000000000000000  0000000000000000  000000d0  2**0</span><br><span class="line">                  CONTENTS, READONLY</span><br><span class="line">  6 .eh_frame     00000058  0000000000000000  0000000000000000  000000d0  2**3</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, DATA</span><br><span class="line">                  </span><br><span class="line"># readelf 可以顯示全部的區段                  </span><br><span class="line">$ readelf -S SimpleSection.o</span><br><span class="line">There are 13 section headers, starting at offset 0x190:</span><br><span class="line"></span><br><span class="line">Section Headers:</span><br><span class="line">  [Nr] Name              Type             Address           Offset    Size              EntSize          Flags  Link  Info  Align</span><br><span class="line">  [ 0]                   NULL             0000000000000000  00000000  0000000000000000  0000000000000000           0     0     0</span><br><span class="line">  [ 1] .text             PROGBITS         0000000000000000  00000040  0000000000000056  0000000000000000  AX       0     0     1</span><br><span class="line">  [ 2] .rela.text        RELA             0000000000000000  000006b0  0000000000000078  0000000000000018          11     1     8</span><br><span class="line">  [ 3] .data             PROGBITS         0000000000000000  00000098  0000000000000008  0000000000000000  WA       0     0     4</span><br><span class="line">  [ 4] .bss              NOBITS           0000000000000000  000000a0  0000000000000004  0000000000000000  WA       0     0     4</span><br><span class="line">  [ 5] .rodata           PROGBITS         0000000000000000  000000a0  0000000000000004  0000000000000000   A       0     0     1</span><br><span class="line">  [ 6] .comment          PROGBITS         0000000000000000  000000a4  000000000000002c  0000000000000001  MS       0     0     1</span><br><span class="line">  [ 7] .note.GNU-stack   PROGBITS         0000000000000000  000000d0  0000000000000000  0000000000000000           0     0     1</span><br><span class="line">  [ 8] .eh_frame         PROGBITS         0000000000000000  000000d0  0000000000000058  0000000000000000   A       0     0     8</span><br><span class="line">  [ 9] .rela.eh_frame    RELA             0000000000000000  00000728  0000000000000030  0000000000000018          11     8     8</span><br><span class="line">  [10] .shstrtab         STRTAB           0000000000000000  00000128  0000000000000061  0000000000000000           0     0     1</span><br><span class="line">  [11] .symtab           SYMTAB           0000000000000000  000004d0  0000000000000180  0000000000000018          12    11     8</span><br><span class="line">  [12] .strtab           STRTAB           0000000000000000  00000650  000000000000005d  0000000000000000           0     0     1</span><br><span class="line">Key to Flags:</span><br><span class="line">  W (write), A (alloc), X (execute), M (merge), S (strings), l (large)</span><br><span class="line">  I (info), L (link order), G (group), T (TLS), E (exclude), x (unknown)</span><br><span class="line">  O (extra OS processing required) o (OS specific), p (processor specific)</span><br></pre></td></tr></table></figure>
<p>區段表是以<code>Elf(32/64)_Shdr</code>結構的陣列</p>
<p>所以陣列內元素個數 = 區段總個數 = There are 13 section headers，共 13 個</p>
<p>但是第一個是無效的，所以有效的有 12 個</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"> 270 /* Section header.  */</span><br><span class="line"> 271</span><br><span class="line"> 272 typedef struct</span><br><span class="line"> 273 &#123;</span><br><span class="line"> 274   Elf32_Word    sh_name;        /* Section name (string tbl index) */</span><br><span class="line"> 275   Elf32_Word    sh_type;        /* Section type */</span><br><span class="line"> 276   Elf32_Word    sh_flags;       /* Section flags */</span><br><span class="line"> 277   Elf32_Addr    sh_addr;        /* Section virtual addr at execution */</span><br><span class="line"> 278   Elf32_Off     sh_offset;      /* Section file offset */</span><br><span class="line"> 279   Elf32_Word    sh_size;        /* Section size in bytes */</span><br><span class="line"> 280   Elf32_Word    sh_link;        /* Link to another section */</span><br><span class="line"> 281   Elf32_Word    sh_info;        /* Additional section information */</span><br><span class="line"> 282   Elf32_Word    sh_addralign;   /* Section alignment */</span><br><span class="line"> 283   Elf32_Word    sh_entsize;     /* Entry size if section holds table */</span><br><span class="line"> 284 &#125; Elf32_Shdr;</span><br><span class="line"> 285</span><br><span class="line"> 286 typedef struct</span><br><span class="line"> 287 &#123;</span><br><span class="line"> 288   Elf64_Word    sh_name;        /* Section name (string tbl index) */</span><br><span class="line"> 289   Elf64_Word    sh_type;        /* Section type */</span><br><span class="line"> 290   Elf64_Xword   sh_flags;       /* Section flags */</span><br><span class="line"> 291   Elf64_Addr    sh_addr;        /* Section virtual addr at execution */</span><br><span class="line"> 292   Elf64_Off     sh_offset;      /* Section file offset */</span><br><span class="line"> 293   Elf64_Xword   sh_size;        /* Section size in bytes */</span><br><span class="line"> 294   Elf64_Word    sh_link;        /* Link to another section */</span><br><span class="line"> 295   Elf64_Word    sh_info;        /* Additional section information */</span><br><span class="line"> 296   Elf64_Xword   sh_addralign;   /* Section alignment */</span><br><span class="line"> 297   Elf64_Xword   sh_entsize;     /* Entry size if section holds table */</span><br><span class="line"> 298 &#125; Elf64_Shdr;</span><br><span class="line"> </span><br><span class="line"># 各區段成員作用</span><br><span class="line">sh_name     # 區段名稱，位於 .shstrtab 的字串表中</span><br><span class="line">sh_type     # 區段類型</span><br><span class="line">sh_flags    # 區段旗標</span><br><span class="line">sh_addr     # 區段虛擬位址</span><br><span class="line">sh_offset   # 區段偏移</span><br><span class="line">sh_size     # 區段長度</span><br><span class="line">sh_link     # 區段連結</span><br><span class="line">sh_info     # 區段資訊</span><br><span class="line">sh_addralign# 區段位址對其</span><br><span class="line">sh_entsize  # 區段項目長度</span><br></pre></td></tr></table></figure>
<p>所以 ELF 結構如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+</span><br><span class="line">|     ELF Header      |</span><br><span class="line">+---------------------+</span><br><span class="line">|       .text         |</span><br><span class="line">+---------------------+</span><br><span class="line">|       .data         |</span><br><span class="line">+---------------------+</span><br><span class="line">|       .bss          |</span><br><span class="line">+---------------------+</span><br><span class="line">|       ....          |</span><br><span class="line">+---------------------+</span><br><span class="line">|     Section TLB     |</span><br><span class="line">|  用來描述 Section   |</span><br><span class="line">+---------------------+</span><br><span class="line">|      .symtab        |</span><br><span class="line">+---------------------+</span><br><span class="line">|      .rel.text      |</span><br><span class="line">+---------------------+</span><br></pre></td></tr></table></figure>
<p>再來看 Type(sh_type) 和 Flags(sh_flags)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">317 /* Legal values for sh_type (section type).  */</span><br><span class="line">318</span><br><span class="line">319 #define SHT_NULL           0           /* Section header table entry unused */</span><br><span class="line">320 #define SHT_PROGBITS       1           /* Program data 程式碼區段 */</span><br><span class="line">321 #define SHT_SYMTAB         2           /* Symbol table 符號表 */</span><br><span class="line">322 #define SHT_STRTAB         3           /* String table 字串表 */</span><br><span class="line">323 #define SHT_RELA           4           /* Relocation entries with addends 重定表 */</span><br><span class="line">324 #define SHT_HASH           5           /* Symbol hash table 符號表的雜湊 */</span><br><span class="line">325 #define SHT_DYNAMIC        6           /* Dynamic linking information 動態連結資訊 */</span><br><span class="line">326 #define SHT_NOTE           7           /* Notes 提示資訊*/</span><br><span class="line">327 #define SHT_NOBITS         8           /* Program space with no data (bss) 沒有內容*/</span><br><span class="line">328 #define SHT_REL            9           /* Relocation entries, no addends 重定資訊 */</span><br><span class="line">329 #define SHT_SHLIB          10          /* Reserved 保留*/</span><br><span class="line">330 #define SHT_DYNSYM         11          /* Dynamic linker symbol table 動態連結符號表*/</span><br><span class="line">331 #define SHT_INIT_ARRAY     14          /* Array of constructors */</span><br><span class="line">332 #define SHT_FINI_ARRAY     15          /* Array of destructors */</span><br><span class="line">333 #define SHT_PREINIT_ARRAY  16          /* Array of pre-constructors */</span><br><span class="line">334 #define SHT_GROUP          17          /* Section group */</span><br><span class="line">335 #define SHT_SYMTAB_SHNDX   18          /* Extended section indeces */</span><br><span class="line">336 #define SHT_NUM            19          /* Number of defined types.  */</span><br><span class="line">337 #define SHT_LOOS           0x60000000  /* Start OS-specific.  */</span><br><span class="line">338 #define SHT_GNU_ATTRIBUTES 0x6ffffff5  /* Object attributes.  */</span><br><span class="line">339 #define SHT_GNU_HASH       0x6ffffff6  /* GNU-style hash table.  */</span><br><span class="line">340 #define SHT_GNU_LIBLIST    0x6ffffff7  /* Prelink library list */</span><br><span class="line">341 #define SHT_CHECKSUM       0x6ffffff8  /* Checksum for DSO content.  */</span><br><span class="line">342 #define SHT_LOSUNW         0x6ffffffa  /* Sun-specific low bound.  */</span><br><span class="line">343 #define SHT_SUNW_move      0x6ffffffa</span><br><span class="line">344 #define SHT_SUNW_COMDAT    0x6ffffffb</span><br><span class="line">345 #define SHT_SUNW_syminfo   0x6ffffffc</span><br><span class="line">346 #define SHT_GNU_verdef     0x6ffffffd  /* Version definition section.  */</span><br><span class="line">347 #define SHT_GNU_verneed    0x6ffffffe  /* Version needs section.  */</span><br><span class="line">348 #define SHT_GNU_versym     0x6fffffff  /* Version symbol table.  */</span><br><span class="line">349 #define SHT_HISUNW         0x6fffffff  /* Sun-specific high bound.  */</span><br><span class="line">350 #define SHT_HIOS           0x6fffffff  /* End OS-specific type */</span><br><span class="line">351 #define SHT_LOPROC         0x70000000  /* Start of processor-specific */</span><br><span class="line">352 #define SHT_HIPROC         0x7fffffff  /* End of processor-specific */</span><br><span class="line">353 #define SHT_LOUSER         0x80000000  /* Start of application-specific */</span><br><span class="line">354 #define SHT_HIUSER         0x8fffffff  /* End of application-specific */</span><br><span class="line"></span><br><span class="line">356 /* Legal values for sh_flags (section flags).  */</span><br><span class="line">358 #define SHF_WRITE              (1 &lt;&lt; 0)   /* Writable 此區段可寫*/</span><br><span class="line">359 #define SHF_ALLOC              (1 &lt;&lt; 1)   /* Occupies memory during execution 此區段在 process 需要分配空間*/</span><br><span class="line">360 #define SHF_EXECINSTR          (1 &lt;&lt; 2)   /* Executable 此區段可執行 */</span><br><span class="line">361 #define SHF_MERGE              (1 &lt;&lt; 4)   /* Might be merged */</span><br><span class="line">362 #define SHF_STRINGS            (1 &lt;&lt; 5)   /* Contains nul-terminated strings */</span><br><span class="line">363 #define SHF_INFO_LINK          (1 &lt;&lt; 6)   /* `sh_info&apos; contains SHT index */</span><br><span class="line">364 #define SHF_LINK_ORDER         (1 &lt;&lt; 7)   /* Preserve order after combining */</span><br><span class="line">365 #define SHF_OS_NONCONFORMING   (1 &lt;&lt; 8)   /* Non-standard OS specific handling required */</span><br><span class="line">367 #define SHF_GROUP              (1 &lt;&lt; 9)   /* Section is member of a group.  */</span><br><span class="line">368 #define SHF_TLS                (1 &lt;&lt; 10)  /* Section hold thread-local data.  */</span><br><span class="line">369 #define SHF_MASKOS             0x0ff00000 /* OS-specific.  */</span><br><span class="line">370 #define SHF_MASKPROC           0xf0000000 /* Processor-specific */</span><br><span class="line">371 #define SHF_ORDERED            (1 &lt;&lt; 30)  /* Special ordering requirement (Solaris).  */</span><br><span class="line">373 #define SHF_EXCLUDE            (1 &lt;&lt; 31)  /* Section is excluded unless referenced or allocated (Solaris).*/</span><br></pre></td></tr></table></figure>
<h2 id="重定表"><a href="#重定表" class="headerlink" title="重定表"></a>重定表</h2><p>有一個區段叫做<code>.rela.text</code>，類型為<code>sh_type</code>，代表對 .text 的重定</p>
<h1 id="連結的介面-符號"><a href="#連結的介面-符號" class="headerlink" title="連結的介面(符號)"></a>連結的介面(符號)</h1><p>兩個目的檔要連結實際上之間對位址的引用</p>
<p>假設 B 要用 A 中的函式，則 A 定義此函式</p>
<p>B 引用此函式，函式和變數為符號，函式名稱和變數名稱為符號名稱</p>
<p>每一個目的檔都有對應的<code>符號表</code>，紀錄目的檔用的所有符號，符號分類如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int g_init_var  = 84;     </span><br><span class="line">int g_uninit_var;         </span><br><span class="line"></span><br><span class="line">void func1(int i)        </span><br><span class="line">&#123;                            </span><br><span class="line">    printf(&quot;%d\n&quot;,i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;                        </span><br><span class="line">    static int static_var1 = 85;  // .data</span><br><span class="line">    static int static_var2;       // .bss</span><br><span class="line">     </span><br><span class="line">    int a = 1;</span><br><span class="line">    int b;  </span><br><span class="line">    func1(static_var1 + static_var2 + a + b);</span><br><span class="line">    return 0;                        </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 全域符號</span><br><span class="line">func1、main、g_init_var</span><br><span class="line"></span><br><span class="line"># 外部符號</span><br><span class="line">printf</span><br><span class="line"></span><br><span class="line"># 區段名稱(由編譯器產生)</span><br><span class="line">.text、.data</span><br><span class="line"></span><br><span class="line"># 區域符號</span><br><span class="line">static_var1、static_var2</span><br><span class="line"></span><br><span class="line"># 行號資訊</span><br></pre></td></tr></table></figure>
<p>符號表可以使用<code>nm</code>或<code>readelf</code></p>
<p>連結過程只關心<code>全域符號</code>和<code>外部符號</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ nm SimpleSection.o</span><br><span class="line">0000000000000000 T func1</span><br><span class="line">0000000000000000 D g_init_var</span><br><span class="line">0000000000000004 C g_uninit_var</span><br><span class="line">0000000000000021 T main</span><br><span class="line">                 U printf</span><br><span class="line">0000000000000004 d static_var1.2184</span><br><span class="line">0000000000000000 b static_var2.2185</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ readelf -s SimpleSection.o</span><br><span class="line"></span><br><span class="line">Symbol table &apos;.symtab&apos; contains 16 entries:</span><br><span class="line">   Num:    Value          Size Type    Bind   Vis      Ndx Name</span><br><span class="line">     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND</span><br><span class="line">     1: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS SimpleSection.c</span><br><span class="line">     2: 0000000000000000     0 SECTION LOCAL  DEFAULT    1</span><br><span class="line">     3: 0000000000000000     0 SECTION LOCAL  DEFAULT    3</span><br><span class="line">     4: 0000000000000000     0 SECTION LOCAL  DEFAULT    4</span><br><span class="line">     5: 0000000000000000     0 SECTION LOCAL  DEFAULT    5</span><br><span class="line">     6: 0000000000000004     4 OBJECT  LOCAL  DEFAULT    3 static_var1.2184</span><br><span class="line">     7: 0000000000000000     4 OBJECT  LOCAL  DEFAULT    4 static_var2.2185</span><br><span class="line">     8: 0000000000000000     0 SECTION LOCAL  DEFAULT    7</span><br><span class="line">     9: 0000000000000000     0 SECTION LOCAL  DEFAULT    8</span><br><span class="line">    10: 0000000000000000     0 SECTION LOCAL  DEFAULT    6</span><br><span class="line">    11: 0000000000000000     4 OBJECT  GLOBAL DEFAULT    3 g_init_var</span><br><span class="line">    12: 0000000000000004     4 OBJECT  GLOBAL DEFAULT  COM g_uninit_var</span><br><span class="line">    13: 0000000000000000    33 FUNC    GLOBAL DEFAULT    1 func1</span><br><span class="line">    14: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT  UND printf</span><br><span class="line">    15: 0000000000000021    53 FUNC    GLOBAL DEFAULT    1 main</span><br></pre></td></tr></table></figure>
<p>符號表也是區段之一，一般叫做<code>.symtab</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Section Headers:</span><br><span class="line">  [Nr] Name              Type             Address           Offset    Size              EntSize          Flags  Link  Info  Align</span><br><span class="line">  [11] .symtab           SYMTAB           0000000000000000  000004d0  0000000000000180  0000000000000018          12    11     8</span><br></pre></td></tr></table></figure>
<p>符號表的結構如下，對應上面的 Num、Value、Size、Type、Bind、Vis、Ndx Name</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">379 /* Symbol table entry.  */</span><br><span class="line">380</span><br><span class="line">381 typedef struct</span><br><span class="line">382 &#123;</span><br><span class="line">383   Elf32_Word    st_name;        /* Symbol name (string tbl index) */</span><br><span class="line">384   Elf32_Addr    st_value;       /* Symbol value */</span><br><span class="line">385   Elf32_Word    st_size;        /* Symbol size */</span><br><span class="line">386   unsigned char st_info;        /* Symbol type and binding */</span><br><span class="line">387   unsigned char st_other;       /* Symbol visibility */</span><br><span class="line">388   Elf32_Section st_shndx;       /* Section index */</span><br><span class="line">389 &#125; Elf32_Sym;</span><br><span class="line">390</span><br><span class="line">391 typedef struct</span><br><span class="line">392 &#123;</span><br><span class="line">393   Elf64_Word    st_name;        /* Symbol name (string tbl index) */</span><br><span class="line">394   unsigned char st_info;        /* Symbol type and binding */</span><br><span class="line">395   unsigned char st_other;       /* Symbol visibility */</span><br><span class="line">396   Elf64_Section st_shndx;       /* Section index */</span><br><span class="line">397   Elf64_Addr    st_value;       /* Symbol value */</span><br><span class="line">398   Elf64_Xword   st_size;        /* Symbol size */</span><br><span class="line">399 &#125; Elf64_Sym;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/Linux/">Linux</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/Linux/">Linux</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
    
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">留言</h1>

  
      <div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/zh_TW/all.js#xfbml=1&appId=790272731165924";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

<div class="fb-comments" data-href="http://jasonchiucc.github.io/2016/09/21/program-self-cultivation-ch3/index.html" data-num-posts="5" data-width="840" data-colorscheme="dark"></div>
      
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜尋">
    <input type="hidden" name="q" value="site:jasonchiucc.github.io">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title" id="categories">分類</h3>
<!--   
	
		<li><a class = "list-2"href="/categories/Swift/AutoLayout/">AutoLayout</a><small>1</small></li>
     
  
	
		<li><a class = "list-2"href="/categories/IOS/BLE/">BLE</a><small>1</small></li>
     
  
	
		<li><a href="/categories/C/">C</a><small>8</small></li>
	
  
	
		<li><a href="/categories/Chrome/">Chrome</a><small>1</small></li>
	
  
	
		<li><a class = "list-2"href="/categories/PHP/Composer/">Composer</a><small>1</small></li>
     
  
	
		<li><a href="/categories/DataStructures/">DataStructures</a><small>2</small></li>
	
  
	
		<li><a class = "list-2"href="/categories/Swift/DesignPattern/">DesignPattern</a><small>3</small></li>
     
  
	
		<li><a href="/categories/Firebase/">Firebase</a><small>5</small></li>
	
  
	
		<li><a href="/categories/Firefox/">Firefox</a><small>5</small></li>
	
  
	
		<li><a href="/categories/GCC/">GCC</a><small>1</small></li>
	
  
	
		<li><a href="/categories/Git/">Git</a><small>1</small></li>
	
  
	
		<li><a href="/categories/Hexo/">Hexo</a><small>3</small></li>
	
  
	
		<li><a href="/categories/IOS/">IOS</a><small>1</small></li>
	
  
	
		<li><a href="/categories/Laravel/">Laravel</a><small>8</small></li>
	
  
	
		<li><a href="/categories/Linux/">Linux</a><small>14</small></li>
	
  
	
		<li><a href="/categories/ML/">ML</a><small>3</small></li>
	
  
	
		<li><a href="/categories/Machine-Learning/">Machine-Learning</a><small>1</small></li>
	
  
	
		<li><a class = "list-2"href="/categories/Storage/Nand-Flash/">Nand-Flash</a><small>1</small></li>
     
  
	
		<li><a href="/categories/Other/">Other</a><small>1</small></li>
	
  
	
		<li><a href="/categories/PHP/">PHP</a><small>2</small></li>
	
  
	
		<li><a href="/categories/PHY/">PHY</a><small>1</small></li>
	
  
	
		<li><a href="/categories/Port/">Port</a><small>1</small></li>
	
  
	
		<li><a href="/categories/Python/">Python</a><small>4</small></li>
	
  
	
		<li><a class = "list-2"href="/categories/Swift/Released/">Released</a><small>1</small></li>
     
  
	
		<li><a href="/categories/Storage/">Storage</a><small>1</small></li>
	
  
	
		<li><a href="/categories/Swift/">Swift</a><small>5</small></li>
	
  
	
		<li><a href="/categories/TOEIC/">TOEIC</a><small>5</small></li>
	
  
	
		<li><a href="/categories/U-Boot/">U-Boot</a><small>1</small></li>
	
  
	
		<li><a href="/categories/Unity/">Unity</a><small>1</small></li>
	
  
	
		<li><a href="/categories/XCode/">XCode</a><small>1</small></li>
	
   -->
     <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DataStructures/">DataStructures</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Firebase/">Firebase</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Firefox/">Firefox</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/GCC/">GCC</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/IOS/">IOS</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/IOS/BLE/">BLE</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Laravel/">Laravel</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ML/">ML</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Machine-Learning/">Machine-Learning</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Other/">Other</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/Composer/">Composer</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHY/">PHY</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Port/">Port</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Storage/">Storage</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Storage/Nand-Flash/">Nand-Flash</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Swift/">Swift</a><span class="category-list-count">5</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Swift/AutoLayout/">AutoLayout</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Swift/DesignPattern/">DesignPattern</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Swift/Released/">Released</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/TOEIC/">TOEIC</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/U-Boot/">U-Boot</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Unity/">Unity</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/XCode/">XCode</a><span class="category-list-count">1</span></li></ul> 
</div>
 

  
<div class="widget tag">
  <h3 class="title">標籤</h3>
  <ul class="entry">
  
    <li><a href="/tags/Add-on/">Add-on</a><small>5</small></li>
  
    <li><a href="/tags/Arduino/">Arduino</a><small>1</small></li>
  
    <li><a href="/tags/Authentication/">Authentication</a><small>1</small></li>
  
    <li><a href="/tags/BLE/">BLE</a><small>1</small></li>
  
    <li><a href="/tags/C/">C</a><small>8</small></li>
  
    <li><a href="/tags/Chrome/">Chrome</a><small>1</small></li>
  
    <li><a href="/tags/CloudMessaging/">CloudMessaging</a><small>1</small></li>
  
    <li><a href="/tags/Code/">Code</a><small>1</small></li>
  
    <li><a href="/tags/Composer/">Composer</a><small>1</small></li>
  
    <li><a href="/tags/DP/">DP</a><small>3</small></li>
  
    <li><a href="/tags/DataStructures/">DataStructures</a><small>2</small></li>
  
    <li><a href="/tags/Extend/">Extend</a><small>1</small></li>
  
    <li><a href="/tags/Extension/">Extension</a><small>1</small></li>
  
    <li><a href="/tags/Firebase/">Firebase</a><small>5</small></li>
  
    <li><a href="/tags/Firefox/">Firefox</a><small>5</small></li>
  
    <li><a href="/tags/GCC/">GCC</a><small>1</small></li>
  
    <li><a href="/tags/Git/">Git</a><small>1</small></li>
  
    <li><a href="/tags/Grammar/">Grammar</a><small>5</small></li>
  
    <li><a href="/tags/Hexo/">Hexo</a><small>3</small></li>
  
    <li><a href="/tags/I2C/">I2C</a><small>1</small></li>
  
    <li><a href="/tags/IOS/">IOS</a><small>1</small></li>
  
    <li><a href="/tags/Kernel/">Kernel</a><small>2</small></li>
  
    <li><a href="/tags/Laravel/">Laravel</a><small>8</small></li>
  
    <li><a href="/tags/Linux/">Linux</a><small>15</small></li>
  
    <li><a href="/tags/Linux（Process）/">Linux（Process）</a><small>1</small></li>
  
    <li><a href="/tags/ML/">ML</a><small>1</small></li>
  
    <li><a href="/tags/Machine-Learning/">Machine-Learning</a><small>5</small></li>
  
    <li><a href="/tags/Nand-Flash/">Nand-Flash</a><small>1</small></li>
  
    <li><a href="/tags/Other/">Other</a><small>1</small></li>
  
    <li><a href="/tags/PCI/">PCI</a><small>2</small></li>
  
    <li><a href="/tags/PHP/">PHP</a><small>1</small></li>
  
    <li><a href="/tags/PHY/">PHY</a><small>1</small></li>
  
    <li><a href="/tags/Port/">Port</a><small>1</small></li>
  
    <li><a href="/tags/Python/">Python</a><small>4</small></li>
  
    <li><a href="/tags/Ram/">Ram</a><small>1</small></li>
  
    <li><a href="/tags/RealtimeDatabase/">RealtimeDatabase</a><small>1</small></li>
  
    <li><a href="/tags/Semaphore/">Semaphore</a><small>1</small></li>
  
    <li><a href="/tags/Swift/">Swift</a><small>5</small></li>
  
    <li><a href="/tags/TOEIC/">TOEIC</a><small>5</small></li>
  
    <li><a href="/tags/U-Boot/">U-Boot</a><small>1</small></li>
  
    <li><a href="/tags/Unity/">Unity</a><small>1</small></li>
  
    <li><a href="/tags/Web/">Web</a><small>1</small></li>
  
    <li><a href="/tags/XCode/">XCode</a><small>1</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2017 JasonChiuCC
  
</div>

<div class="visit">
    本站總訪問量 <span id="busuanzi_value_site_pv"></span>次
</div>

<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>



<!-- 添加『不蒜子』計數服務 -->
<script async src="http://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
